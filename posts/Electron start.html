<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Aoike青池</title>

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://aoike.azurice.com/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<!--<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>-->
<!--<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>-->
<!--<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>-->

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Electron start.md
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        修改于 · 2021-02-08 04:20:22 · 发布于 · 2021-09-23 07:15:15
                    </time>
                </div>
                <div class="post-content">
                    <h2>一、创建程序</h2>
<pre><code class="hljs">MCSH
 │ index<span class="hljs-selector-class">.html</span>
 │ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span>
 └─package<span class="hljs-selector-class">.json</span>
</code></pre>
<h3>1. 创建 <code><span class="hljs-keyword">index</span>.html</code></h3>
<p>渲染进程所需要的 <em>html</em> 文件，可在 <em>VSCode</em> 中用 <code><span class="hljs-attribute">html</span>:<span class="hljs-number">5</span></code> 生成基础模板。</p>
<h3>2. 创建 <code><span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span></code></h3>
<p>主进程 <em>js</em> 文件。</p>
<h3>3. 生成 <code><span class="hljs-keyword">package</span>.json</code></h3>
<pre><code class="hljs language-bash">npm init --yes
</code></pre>
<blockquote>
<p><code><span class="hljs-comment">--yes</span></code> 代替了无脑回车。</p>
</blockquote>
<h2>二、主进程</h2>
<blockquote>
<p>编写 <code><span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span></code></p>
</blockquote>
<h3>1. 引入 <em>electron</em></h3>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> { app, BrowserWindow } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;electron&#x27;</span>)
<span class="hljs-comment">// 或直接 const electron = require(&#x27;electron&#x27;) ，再用 electron.xxx 使用</span>
</code></pre>
<blockquote>
<p>此时在 <em>VSCode</em> 中也许没有自动补全，只需在项目下再安装一次 <em>electron</em> 即可</p>
<pre><code class="hljs language-bash">npm i -y electron --save-dev
</code></pre>
</blockquote>
<h2>2. 监听应用启动事件</h2>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> createWindow = <span class="hljs-function">() =&gt;</span> {
	<span class="hljs-keyword">const</span> mainWindow = <span class="hljs-keyword">new</span> BrowserWindow({
		<span class="hljs-attr">width</span>: <span class="hljs-number">600</span>,
		<span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
        <span class="hljs-attr">webPreferences</span>: {
            <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">true</span>
        }
	})
	
	mainWindow.loadFile( path.join(__dirname, <span class="hljs-string">&#x27;index.html&#x27;</span>) )
	<span class="hljs-comment">// mainWindow.loadURL(&#x27;www.baidu.com&#x27;) 直接加载远程地址</span>
}

app.on(<span class="hljs-string">&#x27;ready&#x27;</span>, createWindow)
</code></pre>
<p>使用 <code><span class="hljs-variable">__dirname</span></code> 来获取当前目录，并使用 <code><span class="hljs-type">path</span>.<span class="hljs-keyword">join</span>()</code> 来拼接。</p>
<blockquote>
<p><code><span class="hljs-type">path</span>.<span class="hljs-keyword">join</span>()</code> 的使用需要引入 <em>nodejs</em> 中的 <em>path</em> 模块</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)
</code></pre>
</blockquote>
<h3>3. 监听应用关闭事件</h3>
<pre><code class="hljs language-js">app.on(<span class="hljs-string">&#x27;window-all-closed&#x27;</span>, app.quit)
</code></pre>
<h2>三、CSS的使用</h2>
<p>照常基操。</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">line</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/base.css&quot;</span>&gt;</span>
</code></pre>
<blockquote>
<p><code><span class="hljs-attribute">href</span></code> 中的路径为以项目目录为根目录，开头不用带 <code>/</code></p>
</blockquote>
<h2>四、渲染进程中nodeJS的使用</h2>
<p>将 <code><span class="hljs-attribute">webPreferences</span></code> 中的 <code><span class="hljs-attribute">nodeIntegration</span></code> 配置为 <code><span class="hljs-literal">true</span></code> 来在渲染进程中使用 <code><span class="hljs-attribute">nodejs</span></code> ，否则不能在渲染进程中 <code><span class="hljs-built_in">require</span></code> 。</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mainWindow = <span class="hljs-keyword">new</span> BrowserWindow({
	<span class="hljs-attr">width</span>: <span class="hljs-number">600</span>,
	<span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
    <span class="hljs-attr">webPreferences</span>: {
        <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">true</span>
    }
})
</code></pre>
<p>然后照常基操。</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;renderer/index.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)

fs.readFile(<span class="hljs-string">&#x27;package.json&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
	<span class="hljs-built_in">console</span>.log(data)
})
</code></pre>
<h2>五、特殊处理 macOS 关闭</h2>
<pre><code class="hljs language-js">app.on(<span class="hljs-string">&#x27;window-all-closed&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
	<span class="hljs-keyword">if</span> (process.platform !== <span class="hljs-string">&#x27;darwin&#x27;</span>) {
		app.quit();
	}
})

app.on(<span class="hljs-string">&#x27;activate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
	<span class="hljs-keyword">if</span> (BrowserWindow.getAllWindows().length === <span class="hljs-number">0</span>) {
		createWindow();
	}
})
</code></pre>

                </div>
            </article>
        </div>

    </div>
</div>
</body>
</html>
